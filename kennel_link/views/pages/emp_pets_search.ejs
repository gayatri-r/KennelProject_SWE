<%- include('../partials/emp-client-head', {title: 'Pets Search', type: 'Employee'}) %>

<body>
  <div class="container">
    <h2>Pet Search</h2>
    <!-- Button to show all pets -->
    <button id="showAllPetsBtn">Show All Pets</button>

    <!-- Table to display pets -->
    <table class="table table-inverse" id="petsTable" style="display: none;">
      <!-- Table headers -->
      <thead>
        <tr>
          <th>Pet Name</th>
          <th>Client Name</th>
          <th>Type</th>
          <th>Breed</th>
          <th></th>
        </tr>
      </thead>
      <!-- Table body to be populated with pets -->
      <tbody>
        <!-- Pets will be dynamically added here -->
      </tbody>
    </table>
  </div>
    <form action="/emp_pets_search" method="GET">
      <input type="text" name="searchQuery" placeholder="Search by Pet Name or Breed">
      <button type="submit">Search</button>
    </form>

    <% if (pets && pets.length > 0) { %>
      <table class="table table-inverse">
        <thead>
          <tr>
            <th>Pet Name</th>
            <th>Client Name</th>
            <th>Type</th>
            <th>Breed</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <% for(var i=0; i < pets.length; i++) { %>
            <tr>
              <td><%= pets[i].petName %></td>
              <td><%= pets[i].clientName %></td>
              <td><%= pets[i].petType %></td>
              <td><%= pets[i].petBreed %></td>
              <td><a href="/emp_pets_edit">Edit</a></td>
              <!-- <td><a href="/emp_pets_edit<%= pets[i]._id %>">Edit</a></td> -->
            </tr>
          <% } %>
        </tbody>
      </table>
    <% } else if (searchQuery) { %>
      <p>No pets found matching the search criteria</p>
    <% } %>
  </div>
</body>
</html>
<script>
  // Get the button element
  const showAllPetsBtn = document.getElementById('showAllPetsBtn');

  // Add click event listener to the button
  showAllPetsBtn.addEventListener('click', async () => {
    try {
      // Fetch all pets from the server
      const response = await fetch('/all_pets');
      const pets = await response.json();

      // Get the table body element
      const tbody = document.querySelector('#petsTable tbody');

      // Clear existing table rows
      tbody.innerHTML = '';

      // Populate the table with pet data
      pets.forEach(pet => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${pet.petName}</td>
          <td>${pet.clientName}</td>
          <td>${pet.petType}</td>
          <td>${pet.petBreed}</td>
          <td><a href="/emp_pets_edit">Edit</a></td>
        `;
        tbody.appendChild(row);
      });

      // Show the table
      document.getElementById('petsTable').style.display = 'block';
    } catch (error) {
      console.error('Error fetching all pets:', error);
    }
  });
</script>